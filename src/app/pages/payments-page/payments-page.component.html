<app-dashboard-template>
<div class="flex flex-col gap-6 p-6">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold text-text-dark dark:text-text-light">Gestão de Pagamentos</h1>
      <p class="text-sm text-text-muted-dark dark:text-text-muted-light mt-1">
        Gerencie pagamentos e comissões dos barbeiros
      </p>
    </div>
    <div class="flex gap-3">
      <app-button
        type="button"
        variant="outline"
        (click)="toggleViewMode()">
        <app-icon [name]="viewMode() === 'list' ? 'people' : 'list'" size="sm"></app-icon>
        {{ viewMode() === 'list' ? 'Ver Barbeiros' : 'Ver Lista' }}
      </app-button>
      <app-button
        type="button"
        variant="secondary"
        (click)="showForm.set(!showForm())">
        <app-icon name="add" size="sm"></app-icon>
        Novo Pagamento
      </app-button>
    </div>
  </div>

  <!-- Success/Error Messages -->
  @if (showSuccessMessage()) {
    <div class="p-4 rounded-lg bg-green-100 dark:bg-green-900/30 border border-green-300 dark:border-green-700">
      <p class="text-sm font-medium text-green-800 dark:text-green-400">{{ message() }}</p>
    </div>
  }

  @if (showErrorMessage()) {
    <div class="p-4 rounded-lg bg-red-100 dark:bg-red-900/30 border border-red-300 dark:border-red-700">
      <p class="text-sm font-medium text-red-800 dark:text-red-400">{{ message() }}</p>
    </div>
  }

  <!-- Payment Form -->
  @if (showForm()) {
    <div class="max-w-2xl">
      <app-payment-form
        [barbeiros]="barbeiros()"
        [selectedBarbeiroId]="selectedBarbeiroId()"
        (submit)="onCreatePayment($event)"
        (cancel)="showForm.set(false)">
      </app-payment-form>
    </div>
  }

  <!-- Summary -->
  <app-payment-summary [payments]="payments()"></app-payment-summary>

  <!-- Filters -->
  @if (viewMode() === 'list') {
    <div class="flex flex-wrap gap-4 items-center">
      <div class="flex items-center gap-2">
        <label class="text-sm font-medium text-text-dark dark:text-text-light">Status:</label>
        <select
          [value]="statusFilter() || 'all'"
          (change)="onStatusFilterChange($any($event.target).value)"
          class="px-3 py-1.5 rounded-lg border border-border-light dark:border-border-dark bg-input-bg-light dark:bg-input-bg-dark text-text-dark dark:text-text-light text-sm focus:outline-none focus:ring-2 focus:ring-primary/50">
          <option value="all">Todos</option>
          <option value="pending">Pendentes</option>
          <option value="paid">Pagos</option>
          <option value="cancelled">Cancelados</option>
        </select>
      </div>

      <div class="flex items-center gap-2">
        <label class="text-sm font-medium text-text-dark dark:text-text-light">Barbeiro:</label>
        <select
          [value]="barbeiroFilter() || 'all'"
          (change)="onBarbeiroFilterChange($any($event.target).value)"
          class="px-3 py-1.5 rounded-lg border border-border-light dark:border-border-dark bg-input-bg-light dark:bg-input-bg-dark text-text-dark dark:text-text-light text-sm focus:outline-none focus:ring-2 focus:ring-primary/50">
          <option value="all">Todos</option>
          @for (barbeiro of barbeiros(); track barbeiro.id) {
            <option [value]="barbeiro.id">{{ barbeiro.name }}</option>
          }
        </select>
      </div>
    </div>
  }

  <!-- Content -->
  @if (viewMode() === 'list') {
    <!-- Payment List -->
    <app-payment-list
      [payments]="filteredPayments()"
      [filterByStatus]="statusFilter()"
      [filterByBarbeiro]="barbeiroFilter()"
      (markAsPaid)="onMarkAsPaid($event)"
      (cancel)="onCancelPayment($event)"
      (viewDetails)="onViewDetails($event)">
    </app-payment-list>
  } @else {
    <!-- Barbers Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      @for (barbeiro of barbeiros(); track barbeiro.id) {
        <app-barber-card
          [barbeiro]="barbeiro"
          [totalPending]="getTotalByBarbeiro(barbeiro.id).pending"
          [totalPaid]="getTotalByBarbeiro(barbeiro.id).paid"
          (viewPayments)="onViewBarberPayments($event)"
          (createPayment)="onCreatePaymentForBarber($event)">
        </app-barber-card>
      }
    </div>
  }
</div>
</app-dashboard-template>

